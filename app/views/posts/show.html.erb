<% breadcrumb :post_show, @post %>

<div class="registration-main">
  <div class="form-wrap">
    <div class="show__header">
      <%= link_to user_path(@post.user.id) do%>
        <div class="show__user-image">
          <% if @post.user.image? %>
            <%= image_tag @post.user.image.url %>
          <% else %>
            <%= image_tag("/images/no-image.png") %>
          <% end %>
        </div>
      <% end %>
      <div class="show__user__name">
        <%= link_to "#{@post.user.nickname}先生", user_path(@post.user.id) %>
      </div>
      <div class="edit_delete">
      <% if user_signed_in? && current_user.id == @post.user_id %>
        <div class="post__manage">
          <%= link_to edit_post_path do%>
            <i class="bi bi-gear"></i>
          <% end %>
          <%= link_to post_path, method: :delete, data: { confirm: "投稿を削除してもよろしいですか？" } do %>
            <i class="bi bi-trash"></i>
          <% end %>
        </div>
      <% end %>
      </div>
    </div>
    <div class="post__show__title">
      基本情報
    </div>
    <table class="table__2">
      <tbody>
        <tr>
          <th class="table__col5", style="border-radius: 5px 0 0 0;">教科名</th>
          <td class="table__col6", style="border-radius: 0 5px 0 0;"><%= @post.subject %></td>
        </tr>
        <tr>
          <th class="table__col5">科目名</th>
          <td class="table__col6"><%= @post.course%></td>
        </tr>
        <tr>
          <th class="table__col5">単元名</th>
          <td class="table__col6"><%= @post.unit %></td>
        </tr>
        <tr>
          <th class="table__col5">教材名</th>
          <td class="table__col6"><%= @post.teaching_materials %></td>
        </tr>
        <tr>
          <th class="table__col5">タグ</th>
          <td class="table__col6"><%= @post.tags&.first&.tag_name %></td>
        </tr>
      </tbody>
    </table>

    <div class="post__show__title">
      授業の展開
    </div>
    <table class="table__3">
      <tbody>
        <th class="table__col7">導入(<%= @post.introduction_time %>)分</th>
          <td class="table__col8"><%= @post.introduction %></td>
        </tr>
        <tr>
          <th class="table__col7">展開(<%= @post.development_time %>)分</th>
          <td class="table__col8"><%= @post.development %></td>
        </tr>
        <tr>
          <th class="table__col7">まとめ(<%= @post.summary_time %>)分</th>
          <td class="table__col8"><%= @post.summary %></td>
        </tr>
      </tbody>
    </table>



    <div class="post__show__title">
      板書案・スライド・添付資料
    </div>

    <div class="post_show_image">
      <% if @post.images.present? %>
        <div class="post__image">
          <%= image_tag @post.images[0]%>
          <div class="other-images">
            <% @post.images[1..-1].each do |image| %>
              <div class="other-image">
                <%= image_tag image %>
              </div>
            <%end%>
          </div>
        </div>
        <%else%>
        <%= link_to image_tag 'no-post.png' %>
      <% end %>
    </div>

    <div class="post__comments">
      <div class="comment-form">
        <% if user_signed_in? %>
          <%= form_with model: [@post, @comment], id: "comment-form" do |f| %>
            <div class="field">
              <%= f.label :content, "コメント" %><br />
              <%= f.text_field :content, id:"comment_content" %>
            </div>
            <div class="actions">
              <%= f.submit "送信する", class: :form__btn  %>
            </div>
          <% end %>
        <% else %>
            <strong><p>※※※ コメントの投稿には新規登録/ログインが必要です ※※※</p></strong>
        <% end %> 
      </div>
      <div id="comments">
        <h4>＜コメント一覧＞</h4>
        <ul class="comments_lists">
          <% @post.comments.each do |comment| %>
            <div class="comment">
              <li class="comment_list">
                <%= "・#{comment.content}" %>
                <%= link_to comment.user.nickname, user_path(@post.user), class: :comment_user %>
              </li>
            </div>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>
